<h1>【Nexys Video DDR3 demo】</h1>

- [1. 概要](#1-概要)
- [2. コーディング規則](#2-コーディング規則)
- [3. ファイル概要](#3-ファイル概要)
- [4. 端子説明](#4-端子説明)
- [5. TODO](#5-todo)
</br></br>

## 1. 概要
評価ボード付属のDDRメモリのデモプレイを管理する。</br>
</br>
参考URL</br>
https://ja.wikipedia.org/wiki/DDR3_SDRAM</br>
https://ja.wikipedia.org/wiki/SDRAM</br>
https://ja.wikipedia.org/wiki/DDR3_SDRAM%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%81%A8%E3%82%AA%E3%83%9A%E3%83%AC%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3</br>
</br>
<!-- ![](res/IMG_3552.jpg) -->
</br>

## 2. コーディング規則
- locparamaなどの定数値は全て大文字で使用</br>
- input outputの端子は小文字・大文字を混ぜたものを使用</br>
- module内のreg・wireは全て小文字で使用</br>
- input output端子に接続する変数名は同じにする</br>
</br>

## 3. ファイル概要
ファイル名 | 詳細
-|-
</br>
</br>

## 4. 端子説明
端子 | 詳細
-|-
  CK,CK# クロック信号 (Clock) | DDR3 SDRAMが動作する基準であるタイミング決定を行う差動クロックを入力する</br>CKの上がりエッジとCK#の下がりエッジの交点を基準にアドレスやコマンドを受け取り、CKとCK#の交点を基準にデータ出力を行う。
 CKE クロックイネーブル信号 (Clock Enable) | デバイスの入出力信号に対してクロックが有効か無効かを決定する。</br>CKE入力がハイでクロックを有効、ローでクロックを無効になる。</br>プリチャージパワーダウン (Precharge Power Down),セルフリフレッシュ (Self Refresh) </br>またはアクティブパワーダウン (Active Power Down) 時にはCKEをローにする。
CS# チップセレクト信号 (Chip Select) | CS# ローでコマンド入力は有効、CS#がハイでコマンド入力は無効。ただし動作中のコマンドはCS#をハイにしても継続する。
ODT オンダイターミネーション信号 (On Die Termination:ODT) | ODTがハイで内蔵する終端抵抗が有効になる。</br>ODTはDQ, DQS, DQS#, DMTDQS# NUDQS#のみ供給され、</br>それ以外の入力ピン (CKE, CS#, RAS#, CAS#, WE#, ODT, RESET#, BA0-BA2 A0-A13) には供給されない。
RAS#,CAS#,WE#</br>ロウアドレスストローブ信号 (Row Address Strobe:RAS)</br>カラムアドレスストローブ信号 (Column Address Strobe:CAS),</br>ライトイネーブル信号(Write Enable:WE) | DDR3 SDRAMの動作を決定するコマンドを入力する（後述のコマンド一覧参照）。
DM(DMU DML) データマスク信号 (Data Mask:DM) | ライト動作時、ハイのときのデータ入力はマスクされデバイスへ書き込まれない。</br>x8デバイスでTDQSを有効にした場合、TDQSとして動作する (DMは無効)。
BA0-BA2 バンクアドレス信号 (Bank Address) | アクティブコマンド (Active) 時にリード/ライトするバンクを選択する。</br>モードレジスタ (Mode Register) の種類 (MR0～MR3) を選択するためにも利用される。
A0-A13 アドレス信号 (Address) | メモリアレイの読み書きしたいセル位置を特定するアドレスを入力する。 </br>アクティブコマンド入力時にロウアドレス、リード/ライトコマンド入力時にバースト動作の先頭カラムアドレスを選択する。</br>モードレジスタ設定にも用いられる。
A10/AP オートプリチャージ信号 (Auto Precharge) | リード/ライトコマンド時に指定するカラムアドレスはA0-A9,A11,A13で指定する。</br>そのためリード/ライトコマンド入力時のA10はアドレス入力に使わない。</br>代わりにA10はリード/ライト後にアクセスしているバンクに対して オートプリチャージを行うか(A10をハイ)、行わないか(A10 ロー)を指定するために用いられる。</br>またプリチャージコマンド入力時にA10はプリチャージの対象バンクの選択に用いられる。</br>A10 ローのときプリチャージはバンク一つに対してのみ行い、A10をハイのときプリチャージは全てのバンクに対して行われる。</br>プリチャージの対象バンクはバンクアドレスで選択する
A12/BC# バーストチョップ (Burst Chop:BC) 信号 | リード/ライトコマンド入力時バースト動作を4データ分で中断する（バーストチョップする）か (A12 ロー)、行わないか (A12をハイ) を選択する。
RESET# リセット信号 (RESET) | リセットピンにローを入力するといつでもデバイスはリセット動作を行う。</br>リセットピンがハイのときは何も行わない。通常動作中はリセットピンは安定してハイを維持する必要がある。</br>リセットピンはCMOSレールトゥレール (Rail to Rail:ハイ/ローの電圧幅いっぱいに振る信号) で電源電圧VDDとグランド電圧VSSに対して80%でハイ、20%でローとなる。</br>例えばVDDが1.5Vの場合は1.2Vでハイ、0.3Vでローとなる。
DQ データ信号 | データの入出力を行う。
DQS DQS# データストローブ信号 (Data Strobe) | データのリード/ライト のタイミングを指定する差動ストローブ信号。</br>ライト時、DQSとDQS#の交点をデータウインドウの中心を打ち抜くタイミングで信号を入力する。</br>リード時、DQS、DQS#のエッジはデータエッジと揃う。
TDQS TDQS# ターミネーションデータストローブ (Termination Data Strobe) | x8 DRAMのみ有効。モードレジスタ (Mode Register) MR1でTDQS機能を有効にした場合、</br>TDQS/TDQS#はDQS/DQS#に対する終端抵抗を提供する。</br>TDQS機能が無効の場合、TDQSはデータマスクとして動作する。TDQS#は使用されない。

## 5. TODO
起動/リセットシーケンス後、各モードレジスタ0~3の設定を行う。
有効コマンド(ACT)を発行し、書き込み/読み込みを行うバンクの行を選択する。
Readコマンド/Writeコマンドを発行し、有効にしたバンク行の列アドレスのデータ操作を行う。
操作し終わったバンクをプリチャージコマンド(PRE{単一バンク},PREA{全バング})を発行し無効にする(無効にして保存する)。

アクティブコマンド
これからアクセスするバンクアドレスをBA0~BA2、行アドレスをA0~A15で指定し有効にする。
同一バンクの他の行アドレスを有効にする場合、すでに開いている行アドレスにプリチャージコマンドを発行する必要がある。

プリチャージコマンド
プリチャージコマンド後、同一バンクを有効にする場合tRP時間経過していなければならない。
プリチャージコマンド入力後、選択バンクはアイドル状態に復帰する。
単一プリチャージコマンドはA10をLowにし、BA0~BA2で対象バンクを選択する。
プリチャージオールコマンドはA10をHighにして、BA0~BA2は0にする。

Readコマンド
有効行アドレス内の列データにアクセスすることができる。
Readコマンドで指定した列アドレスからバースト長分だけデータを連続して出力する。
コマンド発行から[AL + CL]サイクル分、遅延して出力される。
データと同期してSDRAMからDQSも出力される。
なおDQSはデータの出始め前にtRPRE期間プリアンブル (Preamble)、データ終了時にtRPST期間のポストアンブル (Postamble) を出力する。
リード/ライトコマンドの入力時にA12/BC#で動的にバーストチョップ (Burst Chop:BC) の有無 (BC4/BL8) を切り替えることができる。
DQSのクロックに合わせてDQからデータが出力されるわけではなく、tDQSQ分遅延する場合がある。

Writeコマンド
有効行アドレス内の列データにアクセスすることができる。
Writeコマンドで指定した列アドレスからバースト長分だけデータを連続して書き込む。
コマンド発行から[AL + CWL]サイクル分、遅れて書き込み可能になる。
データの中央を打ち抜くタイミングでデータストローブ信号 (DQS) も入力しなければならない。
DQSはデータの出始め前にtWPRE期間プリアンブル (Preamble)、
データ終了時にtWPST期間のポストアンブル (Postamble) を入力しなければならない。
A12/BC#で動的にバーストチョップ (Burst Chop:BC) の有無 (BC4/BL8) を切り替えることができる。
書き込み後、プリチャージを行う場合ライトリカバリタイムサイクル待つ必要がある。

下記の３つについては、read writeの動作確認時に追加予定である。
セルフリフレッシュコマンド
リフレッシュコマンド
パワーダウンモード


</br>